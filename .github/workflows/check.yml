name: winget-pkgs check
on:
  repository_dispatch:
    types: [upstream_push]
  workflow_dispatch:

jobs:
  check:
    runs-on: windows-latest
    timeout-minutes: 360
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6.0.1
        with:
          repository: KarbitsCode/winget-pkgs
          ref: ${{ github.event.client_payload.branch }}
          path: upstream
          fetch-depth: 0

      - name: Check manifests
        id: detect
        shell: powershell
        continue-on-error: true
        run: |
          cd upstream
          Write-Host "===== CheckDependencies (Online) ====="
          .\Tools\CheckDependencies.ps1 -Verbose
          
          Write-Host "===== CheckDependencies (Offline) ====="
          .\Tools\CheckDependencies.ps1 -Offline -Verbose
          
          Write-Host "===== CheckDisplayVersions ====="
          .\Tools\CheckDisplayVersions.ps1 -Verbose
          
          Write-Host "===== CheckMonikers ====="
          .\Tools\CheckMonikers.ps1 -Verbose
